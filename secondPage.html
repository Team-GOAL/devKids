<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Find Sports</title>
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet'/>
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>
    <script src="../Scripts/custom.js"></script>
    <script src​=​'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.min.js'​></script>
    ​
    <link ​rel​=​'stylesheet'
          href​=​'https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v2.2.0/mapbox-gl-geocoder.css'
          type​=​'text/css'​/>

    <link rel="stylesheet" href="../Scripts/jquery-ui-1.12.1/jquery-ui.css">
    <link rel="stylesheet" href="../css/mapStoreLocator.css">
    <link rel="stylesheet" href="../Scripts/bootstrap-4.3.1-dist/css/bootstrap.min.css">
    <!-- animate CSS -->
    <!-- owl carousel CSS -->
    <script src="../Scripts/jquery-3.4.1.min.js"></script>
    <script src="../Scripts/jquery-ui-1.12.1/jquery-ui.js"></script>


</head>
<body style="background-image: url(/../img/background.png)">

<header class="main_menu" style="background-color: #F89B1C">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-12">
                <nav class="navbar navbar-expand-lg navbar-light">
                    <a class="navbar-brand" href="index.html"> <img src="../img/newLogo.PNG" alt="logo"> </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>

                    <div class="collapse navbar-collapse main-menu-item justify-content-center"
                         id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item active">
                                <a class="nav-link" href="index.html">Home</a>
                            </li>   <!--MOVE TO THE LEFT-->
                            <li class="nav-item">   <!--Change this file-->
                                <a class="nav-link" href="secondPage.html">Find Sports</a>
                            </li>
                        </ul>
                    </div>

                </nav>
            </div>
        </div>
    </div>
</header>
<section>
    <div style="border-top: 6px solid #C30691">
        <p style="font-family: Times New Roman; font-weight: 100; font-size: 30px; text-align: center;color: black; background-color: antiquewhite">
            Type in your suburb and find the sports facilities nearby!
        </p>
    </div>

</section>

<div class="container" style="margin: 5%">
    <div class="row">
        <div class="col-md-6 offset-md-3" style="align-content: center; align-self: center">
            <form id="mapForm" name="mapForm" action="" method="post">
                <p style="font-family: Times New Roman; font-size: 15px; color: black">Select your suburb:
                    <input type="text" name="suburb" id="suburb"/></p>

                <label for="sports">Select a sports activity</label>
                <select name="sports" id="sports">
                    <h4>Select your preference and see recommended sports activities</h4>
                    <option value="Australian Rules Football">Australian Rules Football</option>
                    <option value="Basketball">Basketball</option>
                    <option value="Cricket">Cricket</option>
                    <option value="Cycling">Cycling</option>
                    <option value="Dancing">Dancing</option>
                    <option value="Fitness / Gymnasium Workouts">Fitness / Gymnasium Workouts</option>
                    <option value="Soccer" selected="selected">Soccer</option>
                    <option value="Golf">Golf</option>
                    <option value="Gymnastics">Gymnastics</option>
                    <option value="Athletics">Athletics</option>
                    <option value="Swimming">Swimming</option>
                    <option value="Tennis">Tennis</option>
                    <option value="Walking">Walking</option>
                    <option value="Tennis">Tennis</option>
                    <option value="Netball">Netball</option>
                    <option value="Yoga">Yoga</option>
                </select>
                <br>
            </form>
            <button type="button" form="mapForm" id="mapButton" value="Submit">Search by Suburb or Activity</button>
        </div>
        <p>* Please refresh the page to search for another facility. </p>

    </div>
</div>
<div>
<div class= "col-3"></div>
<div class= "col-6" id='displayLocations'></div>
<div class= "col-3"></div>
</div>
<section>
    <p style="font-family: Times New Roman; font-weight: 100; font-size: 30px; text-align: center;color: black; background-color: antiquewhite">
        Select your preference and see recommended sports activities
    </p>
</section>

<div class="container" style="margin: 5%">
    <div class="row">

        <div class="col-md-6 offset-md-3"
             style="align-content: center; align-self: center; border: 16px groove red; padding: 5%">
            <form id="preferenceForm" name="preferenceForm"
                  action="" method="post">
                <div id="ageList">
                    <label for="age">Select your child's age</label>
                    <br>
                    <select name="age" id="age">
                        <option>0</option>
                        <option>1</option>
                        <option>2</option>
                        <option>3</option>
                        <option>4</option>
                        <option>5</option>
                        <option>6</option>
                        <option selected="selected">7</option>
                        <option>8</option>
                        <option>9</option>
                        <option>10</option>
                        <option>11</option>
                        <option>12</option>
                        <option>13</option>
                        <option>14</option>
                    </select>
                </div>
                <div id="genderList">
                    <label for="gender">Select your child's gender</label>
                    <br>
                    <select name="gender" id="gender">
                        <option selected="selected">male</option>
                        <option>female</option>
                    </select>
                </div>
                <div id="teamList">
                    <label for="teamIndividual">Team or individual sports?</label>
                    <br>
                    <select name="teamIndividual" id="teamIndividual">
                        <option selected="selected">team</option>
                        <option>individual</option>
                    </select>
                </div>
                <div id="indoorList">
                    <label>Indoor or Outdoor?</label>
                    <br>
                    <select name="indoorOutdoor" id="indoorOutdoor">
                        <option selected="selected">indoor</option>
                        <option>outdoor</option>
                    </select>
                </div>
                <br>
                <div id="activityResult">
                </div>
                <button type="button" form="preferenceForm" id="preferenceButton" value="Submit">See our
                    recommendation
                </button>
            </form>
            <div id='displayPreference'></div>

        </div>
        <div class='heading'>
            <h4>Locations of Sports Facilities</h4>
        </div>
        <div id="chinesePopulation">
            <?php
            include '../php/server%20receive%20request%20on%20sports.php';
            ?>
        </div>
    </div>
    <div id='listings' class='listings'></div>
</div>
</div>
</div>

<div ​id​=​"map"​ ​style​=​"height:300px"​></div>
<footer class="footer-area" style="padding-top: 50px">
    <div class="container">
        <div class="row">
            <div class="col-xl-3 col-lg-6 col-sm-6 mb-4 mb-xl-0 single-footer-widget">
                <h4>about us</h4>
                <p>We want to help chinese mothers to raise their children in Melbourne. </p>
            </div>
            <div class="col-xl-3 col-lg-6 col-sm-6 mb-4 mb-xl-0 single-footer-widget">
                <h4>Find Sports</h4>
                <ul>
                    <li><a href="secondPage.html">Sports Map</a></li>
                    <li><a href="secondPage.html">Recommendation for My Kid</a></li>
                </ul>
            </div>
        </div>

    </div>
</footer>

</body>
</html>
<script type="text/javascript">
    setTimeout(function () {
        instantializeMap();
    }, 2000);

    $(document).ready(function () {
        $("#mapButton").click(function (e) {
            $('#displayLocations').empty();
            e.preventDefault();
            $.ajax({
                url: "../php/server%20receive%20request%20on%20sports.php",
                type: "POST",
                data: $('#mapForm').serialize(),
                success: function (data) { // Pop the location data on map
                    var output = "";
                    for (var i in data) {
                        output += "<br>" + data[i].facilityName + ": " + data[i].address + "<br>";
                        output += "Sports activity: " +  data[i].sports + "<br>";
                    }
                    output += "</tbody></table>";
                    $('#displayLocations').append(output);
                },
                error: function (jqxhr, status, exception) {
                    alert("No result found. Please refresh and search again.");
                }
            });
            $("#mapButton").unbind();
        });
    });

    $(document).ready(function () {
        $("#preferenceButton").click(function (e) {
            $('#displayPreference').empty();
            e.preventDefault();
            $.ajax({
                url: "../php/testPreference.php",
                type: "POST",
                data: $('#preferenecForm').serialize(),
                //age: $('#age').val(),
                // gender: genderVal,
                //teamIndividual:teamVal,
                //indoorOutdoor: indoorVal
                success: function (data) {
                    //TODO change the display of the output
                    //  var sports = getJson("sportsActivity", response);
                    var output =  "<br>" + "Recommended Activities: "+ "<br>";
                    for (var i in data) {
                        output += "<br>" + data[i].sportsActivity;
                    }
                    output += "</tbody></table>";
                    $('#displayPreference').append(output);

                },
                error: function (jqxhr, status, exception) {
                    alert(status);
                    alert(exception);
                }
            });
        });
    });

    function getJson(key, jsonObj) {
        //1、Use eval
        var eValue = eval('jsonObj.' + key);
        return eValue;
    }


    function instantializeMap() {
        mapboxgl.accessToken = "pk.eyJ1Ijoiem9lMDkyNSIsImEiOiJjazAwZWFnZmoyMnl4M2NtdjhscXEzYnV0In0.BZBB5B0chsPE5Yef4LHp-w";
// This adds the map to your page
        var map = new mapboxgl.Map({
            // container id specified in the HTML
            container: 'map',
            // style URL
            style: 'mapbox://styles/mapbox/light-v10',
            // initial position in [lon, lat] format
            center: [-37.818078, 144.96681],
            // initial zoom
            zoom: 11
        });
        map.on('load', function (e) {
            // Add the data to your map as a layer
            var gson = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "geometry": {
                            "type": "Point",
                            "coordinates": [
                                -37.818078,
                                144.96681
                            ]
                        },
                        "properties": {
                            "address": "Flinders St",
                            "city": "Melbourne",
                            "postalCode": "3000",
                            "state": "VIC"
                        }
                    }]
            };
            loadMap(gson);

            //buildLocationList(gson);
        });
    }

    function loadMap(gson) {
        map.on('load', function (e) {
            // Add the data to your map as a layer
            map.addLayer({
                id: 'locations',
                type: 'symbol',
                // Add a GeoJSON source containing place coordinates and information.
                source: {
                    type: 'geojson',
                    data: gson
                },
                layout: {
                    'icon-image': 'restaurant-15',
                    'icon-allow-overlap': true
                }
            });
        });
    }


</script>